---
description: 
globs: **/*.spec.js, **/pages/*.js, **/*Page.js
alwaysApply: false
---

# Playwright con JavaScript - Page Object Model y Mejores Prácticas

## Estructura del Page Object Model (POM)

### Clase Page Object

```javascript
// ✅ GOOD - Estructura correcta de Page Object
export class LoginPage {
  constructor(page) {
    this.page = page;
    // Selectores como propiedades de clase
    this.usernameInput = '#user-name';
    this.passwordInput = '#password';
    this.loginButton = '#login-button';
  }

  // Métodos de navegación
  async goto() {
    await this.page.goto('/');
  }

  // Métodos de acción que encapsulan la lógica
  async login(username, password) {
    await this.page.fill(this.usernameInput, username);
    await this.page.fill(this.passwordInput, password);
    await this.page.click(this.loginButton);
  }

  // Métodos de verificación/assertions
  async isLoggedIn() {
    return await this.page.locator('.inventory_item').count() > 0;
  }
}
```

### Principios del POM

- **Encapsulación**: Cada Page Object encapsula los elementos y acciones de una página
- **Reutilización**: Los métodos pueden ser reutilizados en múltiples tests
- **Mantenibilidad**: Cambios en la UI solo requieren actualizar el Page Object
- **Separación de responsabilidades**: Tests contienen la lógica de negocio, Page Objects contienen la interacción con la UI

## Mejores Prácticas de Playwright

### Selectores

```javascript
// ✅ GOOD - Selectores específicos y estables
this.usernameInput = '#user-name';  // ID es preferible
this.errorMessage = '[data-test="error"]';  // data-test attributes
this.productCard = '.inventory_item';  // Clases CSS cuando es necesario

// ❌ BAD - Selectores frágiles
this.usernameInput = 'div > div > input:nth-child(2)';  // Evitar selectores complejos
this.usernameInput = 'input[type="text"]';  // Demasiado genérico
```

**Reglas de selectores:**
1. Priorizar `data-testid` o `data-test` attributes
2. Usar IDs cuando estén disponibles
3. Evitar selectores basados en posición (nth-child)
4. Preferir selectores cortos y específicos

### Esperas y Timeouts

```javascript
// ✅ GOOD - Usar esperas implícitas de Playwright
await this.page.fill(this.usernameInput, username);  // Auto-wait incluido
await this.page.click(this.loginButton);  // Espera automática a que sea clickeable

// ✅ GOOD - Esperas explícitas cuando sea necesario
await this.page.waitForSelector('.inventory_item', { state: 'visible' });
await this.page.waitForLoadState('networkidle');

// ❌ BAD - Esperas fijas innecesarias
await this.page.waitForTimeout(5000);  // Evitar esperas fijas
```

### Manejo de Errores

```javascript
// ✅ GOOD - Manejo de errores con mensajes descriptivos
async login(username, password) {
  try {
    await this.page.fill(this.usernameInput, username);
    await this.page.fill(this.passwordInput, password);
    await this.page.click(this.loginButton);
  } catch (error) {
    throw new Error(`Failed to login with user ${username}: ${error.message}`);
  }
}

// ✅ GOOD - Validaciones antes de acciones
async addProductToCart(productName) {
  const product = this.page.locator('.inventory_item').filter({ hasText: productName });
  
  if (await product.count() === 0) {
    throw new Error(`Product "${productName}" not found`);
  }
  
  await product.locator('button').click();
}
```

## Estructura de Tests

### Organización de Tests

```javascript
// ✅ GOOD - Estructura clara con describe y beforeEach
import { test, expect } from '@playwright/test';
import { LoginPage } from '../pages/LoginPage';

test.describe('Login functionality', () => {
  let loginPage;

  test.beforeEach(async ({ page }) => {
    loginPage = new LoginPage(page);
    await loginPage.goto();
  });

  test('TC-01 Login with valid credentials', async ({ page }) => {
    await loginPage.login('standard_user', 'secret_sauce');
    await expect(page).toHaveURL(/inventory/);
  });
});
```

### Naming Conventions

- **Tests**: Usar nombres descriptivos que expliquen qué se está probando
- **Métodos de Page Objects**: Verbos en infinitivo (login, addProduct, navigate)
- **Selectores**: Nombres descriptivos que indiquen el elemento (usernameInput, loginButton)

### Assertions

```javascript
// ✅ GOOD - Assertions específicas y descriptivas
await expect(page).toHaveURL(/inventory/);
await expect(page.locator('.inventory_item')).toHaveCount(6);
await expect(page.locator(loginPage.errorMessage)).toBeVisible();

// ❌ BAD - Assertions genéricas o innecesarias
await expect(page).not.toBeNull();  // Demasiado genérico
```

## Mejores Prácticas de JavaScript

### Uso de async/await

```javascript
// ✅ GOOD - Siempre usar async/await
async login(username, password) {
  await this.page.fill(this.usernameInput, username);
  await this.page.fill(this.passwordInput, password);
  await this.page.click(this.loginButton);
}

// ❌ BAD - Evitar callbacks o promesas sin await
login(username, password) {
  this.page.fill(this.usernameInput, username).then(() => {
    // ...
  });
}
```

### Constantes y Configuración

```javascript
// ✅ GOOD - Separar datos de prueba en archivos de configuración
import { users } from '../config/users';

await loginPage.login(users.standard.username, users.standard.password);

// ✅ GOOD - Usar constantes para valores repetidos
const TIMEOUT = 5000;
const BASE_URL = 'https://www.saucedemo.com';
```

### Métodos Reutilizables

```javascript
// ✅ GOOD - Crear métodos helper reutilizables
async waitForPageLoad() {
  await this.page.waitForLoadState('networkidle');
  await this.page.waitForSelector('body');
}

async takeScreenshot(name) {
  await this.page.screenshot({ path: `screenshots/${name}.png` });
}
```

## Convenciones de Código

1. **Una clase por página**: Cada Page Object representa una página o componente
2. **Métodos pequeños**: Cada método debe hacer una cosa específica
3. **Nombres descriptivos**: Variables y métodos deben ser autoexplicativos
4. **Comentarios cuando sea necesario**: Solo comentar lógica compleja o no obvia
5. **Exportar clases**: Usar `export class` para Page Objects

## Estructura de Archivos Recomendada

```
tests/
  login.spec.js
  cart.spec.js
pages/
  LoginPage.js
  ProductsPage.js
  CartPage.js
config/
  users.js
  test-data.js
utils/
  helpers.js
```

## Anti-patrones a Evitar

- ❌ No mezclar lógica de negocio con Page Objects
- ❌ No usar esperas fijas (waitForTimeout) innecesariamente
- ❌ No crear Page Objects demasiado grandes (dividir en componentes)
- ❌ No hardcodear valores en los tests (usar configuración)
- ❌ No repetir código (crear métodos helper reutilizables)
